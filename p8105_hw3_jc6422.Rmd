---
title: "p8105_hw3_jc6422"
author: "Jianing Chen"
date: "2024-10-09"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Problem 1

load the data from packages

```{r}
library(p8105.datasets)
library(tidyverse)
library(ggplot2)
library(patchwork)
data("ny_noaa")
```

data cleaning

```{r}
ny_noaa_df = ny_noaa |>
  mutate(
    date = as.Date(date),
    year = year(date),
    month = month(date),
    day = day(date),
    tmax = as.numeric(tmax) / 10,  
    tmin = as.numeric(tmin) / 10,  
    prcp = as.numeric(prcp) / 10,
    snow = snow
  ) %>%
  filter(!is.na(tmax) & !is.na(tmin) & !is.na(snow) & !is.na(prcp)) 

ny_noaa_df
```

This data has `r nrow(ny_noaa_df)` rows and `r ncol(ny_noaa_df)` columns. The variables are `r names(ny_noaa_df)`.

Make a two-panel plot showing the average max temperature in January and in July in each station across years.

```{r}
january = ny_noaa_df %>% 
  filter(month == 1)

july = ny_noaa_df %>% 
  filter(month == 7)

jan_avg_tmax = january %>% 
  group_by(id, year) %>% 
  summarize(avg_tmax = mean(tmax, na.rm = TRUE))%>%
  mutate(month="January")

jul_avg_tmax = july %>% 
  group_by(id, year) %>% 
  summarize(avg_tmax = mean(tmax, na.rm = TRUE))%>%
  mutate(month="July")

combined_data = bind_rows(jan_avg_tmax, jul_avg_tmax)

ggplot(combined_data, aes(x = as.numeric(year),y=avg_tmax)) +
  geom_point(aes( color = month)) +
  labs(title = "Average Max Temperature in January and July", 
       x = "Year", 
       y = "Average Max Temperature") +
  facet_grid(month~.) +
  scale_color_manual(values = c("January" = "blue", "July" = "red")) +
  theme_minimal()

```

Observations:

The blue plot represents the distribution of average maximum temperatures in January.
This structure suggests relatively stable temperatures with some fluctuation over time.

The red plot represents the distribution of average maximum temperatures in July. This structure is also relatively stable. There is an outlier in 1988.

Make a two-panel plot showing :

(i) tmax vs tmin for the full dataset 
(ii) make a plot showing the distribution of snowfall values greater than 0 and less than 100 separately by year.

```{r}
p1 = ggplot(ny_noaa_df, aes(x = tmin, y = tmax)) +
  geom_bin2d(bins = 30) +
  scale_fill_viridis_c() +
  labs(title = "Tmax vs Tmin", x = "Minimum Temperature (Tmin)", y = "Maximum Temperature (Tmax)") +
  theme_minimal()

snow_filtered = ny_noaa_df %>%
  filter(snow > 0 & snow < 100)

p2 = ggplot(snow_filtered, aes(x = snow, fill = factor(year))) +
  geom_density(alpha = 0.5) +  
  labs(title = "Density of Snowfall (0 < Snow < 100) by Year", x = "Snowfall (cm)", y = "Density") +
  theme_minimal()

combined_plot = p1 / p2

combined_plot
```

## Problem 2

Load and clean the datasets.

```{r}
accel = read_csv("data/nhanes_accel.csv")
covar = read_csv("data/nhanes_covar.csv",skip = 4) 
colnames(covar) = c("SEQN", "sex", "age", "BMI", "education")
merged_data = accel %>%
  left_join(covar, by = "SEQN") %>%
  filter(age >= 21, !is.na(education), !is.na(sex), !is.na(age))
merged_data
```



